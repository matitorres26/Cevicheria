{% extends "base.html" %}
{% load static %}

{% block title %}Tu Pedido - SOS{% endblock %}

{% block content %}

<!-- CSS + JS -->
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
<script src="{% static 'js/checkout.js' %}" defer></script>

<main class="checkout-wrapper" aria-labelledby="checkout-title">

  <!-- HEADER -->
  <header class="checkout-header">
    <h1 id="checkout-title">Tu Pedido en SOS</h1>
    <p>Salvamos tu apetito con estilo — completa tus datos y envíanos tu orden</p>
  </header>

  <section class="checkout-body" aria-live="polite" aria-atomic="true">

    <!-- CARRITO -->
    <div id="cart"></div>

    <!-- FORMULARIO -->
    <form id="checkoutForm" novalidate>
      {% csrf_token %}

      <fieldset class="form-grid">
        <legend class="visually-hidden">Datos del cliente</legend>

        <div class="form-group">
          <label for="f_name">Nombre completo*</label>
          <input id="f_name" name="name" required placeholder="Ej: Juan Pérez" autocomplete="name">
        </div>

        <div class="form-group">
          <label for="f_phone">Teléfono</label>
          <input id="f_phone" name="phone" placeholder="+56 9 1234 5678" autocomplete="tel">
        </div>

        <div class="form-group">
          <label for="f_email">Correo electrónico</label>
          <input id="f_email" type="email" name="email" placeholder="cliente@email.com" autocomplete="email">
        </div>

        <div class="form-group full">
          <label for="f_address">Dirección de entrega</label>
          <input id="f_address" name="address" placeholder="Ej: Av. Costanera 123, Viña del Mar" autocomplete="street-address">
        </div>

        <div class="form-group">
          <label for="f_payment">Método de pago</label>
          <select id="f_payment" name="payment_method">
            <option value="CASH">Pagar en local / Efectivo</option>
            <option value="WEBPAY">Webpay</option>
          </select>
        </div>
      </fieldset>

      <div class="btn-group">
        <button type="submit" class="btn btn-primary" id="btn-submit" aria-label="Enviar pedido">
          Enviar Pedido
        </button>

        <button type="button" class="btn btn-secondary" id="btn-clear">
          Vaciar Carrito
        </button>
      </div>

      <div id="msg" role="alert"></div>

    </form>

  </section>
</main>

<!-- ======================= -->
<!--     MODAL DE ÉXITO     -->
<!-- ======================= -->

<div id="modalGracias" class="modal-overlay" aria-modal="true" role="dialog">
  <div class="modal-box">

    <header class="modal-header">
      <h3>Pedido Confirmado</h3>
      <p>N° <strong id="b_id_header"></strong></p>
    </header>

    <section class="modal-body">

      <!-- TIMER -->
      <div class="timer-box">
        <p class="timer-label">Tiempo estimado</p>
        <p id="timerTexto" class="timer-value">35m 00s</p>
      </div>

      <!-- TICKET -->
      <article class="ticket">
        <p class="ticket-title">Cevichería SOS</p>

        <div class="ticket-info">
          <p><strong>Cliente:</strong> <span id="b_nombre"></span></p>
          <p><strong>Fecha:</strong> <span id="b_fecha"></span></p>
          <div id="extra-info"></div>
        </div>

        <table class="ticket-items">
          <tbody id="b_items"></tbody>
        </table>

        <div class="ticket-total">
          TOTAL <span id="b_total"></span>
        </div>
      </article>

      <!-- BOTONES -->
      <button class="btn btn-primary full" onclick="cerrarModalGracias()">
        Volver al Menú
      </button>

      <button class="btn btn-dark full" onclick="imprimirBoleta()">
        Imprimir Boleta (PDF)
      </button>

    </section>
  </div>
</div>

{% endblock %}
