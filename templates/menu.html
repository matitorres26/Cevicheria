{% extends "base.html" %}
{% block title %}Men√∫ - SOS Cevicher√≠a & Subh√≠{% endblock %}

{% block content %}
<style>
/* ====== RESET Y TIPOGRAF√çA ====== */
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family:'Poppins', sans-serif; color:#2d3748; background:#fefefe;}

/* ====== HERO ANIMADO CON BAMBU ====== */
#inicio {position: relative; text-align:center; color:#fff; overflow:hidden;
  background: linear-gradient(135deg,#00A699 0%,#0077B6 100%);
  height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;}
#inicio::before {content:''; position:absolute; top:0; left:0; width:100%; height:100%;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="5" y="0" width="2" height="100" fill="%2300A699"/><rect x="25" y="0" width="2" height="100" fill="%2300A699"/><rect x="45" y="0" width="2" height="100" fill="%2300A699"/><rect x="65" y="0" width="2" height="100" fill="%2300A699"/><rect x="85" y="0" width="2" height="100" fill="%2300A699"/></svg>') repeat-x;
  opacity:0.08; z-index:0; animation:bambooMove 20s linear infinite;}
@keyframes bambooMove {0%{background-position-x:0;} 100%{background-position-x:200px;}}
.logo-text { font-size:2rem; font-weight:700; color:#ff4040; text-transform:uppercase; letter-spacing:1px; z-index:1; position:relative; }
nav {margin-top:30px; z-index:1; position:relative;}
nav a {color:#fff; margin:0 15px; font-weight:500; text-decoration:none; position:relative; transition:0.3s;}
nav a::after {content:''; position:absolute; width:0; height:2px; bottom:-5px; left:0; background:#2ecc71; transition:0.3s;}
nav a:hover::after {width:100%;}
nav a.btn {background:linear-gradient(90deg,#2ecc71,#27ae60); padding:12px 25px; border-radius:25px; font-weight:600; transition:0.3s;}
nav a.btn:hover {transform:scale(1.05);}
#inicio h1 {font-size:3rem; font-weight:800; text-shadow:2px 2px 8px rgba(0,0,0,0.3); margin-bottom:20px; animation:fadeIn 1.5s ease forwards; opacity:0; z-index:1; position:relative;}
@keyframes fadeIn {0%{opacity:0; transform:translateY(20px);} 100%{opacity:1; transform:translateY(0);}}
.btn-success, .btn-warning {border:none; border-radius:30px; padding:15px 35px; font-weight:600; letter-spacing:1px; text-transform:uppercase; transition:all 0.3s ease; z-index:1; position:relative;}
.btn-success {background:linear-gradient(90deg,#2ecc71,#27ae60); color:#fff;}
.btn-success:hover {transform:scale(1.1);}
.btn-warning {background:linear-gradient(90deg,#f1c40f,#f39c12); color:#2d3748;}
.btn-warning:hover {transform:scale(1.1);}

/* ====== MEN√ö ====== */
#menu {padding:80px 0; background:#f9fafb;}
#menu h2 {font-size:2.8rem; font-weight:700; color:#2d3748; border-bottom:4px solid #2ecc71; display:inline-block; padding-bottom:10px; margin-bottom:50px; letter-spacing:2px;}
#products {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:30px;}
.card {background:#fff; border-radius:20px; overflow:hidden; box-shadow:0 10px 20px rgba(0,0,0,0.08); transition:transform 0.3s ease, box-shadow 0.3s ease; cursor:pointer; display:flex; flex-direction:column; justify-content:space-between;}
.card:hover {transform:translateY(-10px) rotateX(2deg); box-shadow:0 15px 30px rgba(0,0,0,0.12);}
.card-img-top {height:220px; object-fit:cover; border-top-left-radius:20px; border-top-right-radius:20px; transition:transform 0.3s;}
.card-img-top:hover {transform:scale(1.05);}
.card-body {padding:20px; text-align:center;}
.card-title {font-size:1.4rem; font-weight:600; color:#2d3748; margin-bottom:10px;}
.card-text {font-size:1.2rem; font-weight:500; color:#2ecc71; margin-bottom:15px;}
.btn-outline-primary {border:2px solid #007bff; color:#007bff; border-radius:25px; padding:10px 25px; font-weight:600; transition:all 0.3s;}
.btn-outline-primary:hover {background:#007bff; color:#fff; transform:scale(1.05);}

/* ====== FOOTER ====== */
#contacto {padding:60px 0; background:#1a202c; color:#fff; text-align:center; border-top:5px solid #2ecc71;}
#contacto h3 {font-size:1.8rem; color:#ffd700; margin-bottom:20px;}
#contacto p {font-size:1.1rem; margin-bottom:10px;}
#contacto a {color:#fff; font-size:1.6rem; margin:0 12px; transition:0.3s;}
#contacto a:hover {color:#2ecc71; transform:scale(1.2);}

/* MODAL CANTIDAD */
#qtyModal {
  position: fixed; top:0; left:0; width:100%; height:100%;
  display:none; justify-content:center; align-items:center;
  background: rgba(0,0,0,0.5); z-index:9999;
}
#qtyModal .modal-content {
  background:#fff; padding:30px; border-radius:20px; text-align:center;
  min-width:300px;
}
#qtyModal button {margin:0 10px; padding:10px 20px; border:none; border-radius:10px; font-size:1.2rem; cursor:pointer;}
#qtyModal .close {position:absolute; top:10px; right:20px; font-size:1.5rem; cursor:pointer;}
</style>

<!-- HERO -->
<section id="inicio">
  <div class="container d-flex flex-column align-items-center">
    <div class="d-flex align-items-center mb-4">
      <img src="https://placehold.co/60x60/f83e3e/ffffff?text=SOS" alt="Logo" class="rounded-circle" style="height:60px;width:60px;">
      <h1 class="ms-3 logo-text">SOS CEVICHER√çA & SUSH√ç</h1>
    </div>
    <nav>
      <a href="#inicio">Inicio</a>
      <a href="#menu">Men√∫</a>
      <a href="#promociones">Promociones</a>
      <a href="#nosotros">Nosotros</a>
      <a href="#pedido" class="btn">Pedir Ahora</a>
    </nav>
    <h1 class="display-4 fw-bold mt-5">¬°Salvamos tu apetito!</h1>
    <h1 class="display-4 fw-bold mt-5">Abierto : Lunes, Miercoles y jueves de 17 a 23 horas</h1>
    <div class="mt-4">
      <a href="#menu" class="btn btn-success btn-lg scroll-btn me-2">Ver Men√∫</a>
      <a href="#pedido" class="btn btn-warning btn-lg">Haz tu Pedido</a>
    </div>
  </div>
</section>

<!-- MEN√ö -->
<section id="menu" class="container py-5">
  <h2 class="text-center fw-bold mb-5">Men√∫</h2>
  <div id="products" class="row g-4"></div>
  <div class="text-center mt-4">
    <a href="/checkout/" class="btn btn-primary btn-lg">Ir al pedido</a>
  </div>
</section>

<!-- MODAL CANTIDAD -->
<div id="qtyModal">
  <div class="modal-content position-relative">
    <span class="close" id="closeModal">&times;</span>
    <h3>Agregar al carrito</h3>
    <p id="modalProductName" class="fw-bold"></p>
    <div class="d-flex justify-content-center align-items-center mt-3">
      <button id="decQty">‚àí</button>
      <span id="qtyValue" style="margin:0 15px; font-size:1.2rem;">1</span>
      <button id="incQty">+</button>
    </div>
    <button id="addToCartModal" class="btn btn-success mt-3">Agregar</button>
  </div>
</div>

<!-- FOOTER -->
<footer id="contacto">
  <div class="row">
    <div class="col-12 col-md-6 mb-4">
      <h3>Contacto</h3>
      <p>üìç Av. del Sabor 123, Santiago</p>
      <p>üìû +56 9 1234 5678</p>
      <p>üìß contacto@soscevicheria.cl</p>
      <p>Lun. - S√°b: 11:00-23:00 | Dom: 12:00-23:00</p>
    </div>
    <div class="col-12 col-md-6">
      <h3>S√≠guenos</h3>
      <div class="mt-3">
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-tiktok"></i></a>
      </div>
    </div>
  </div>
</footer>

<script>
// Scroll suave
document.querySelectorAll('.scroll-btn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    e.preventDefault();
    const target = document.querySelector(btn.getAttribute('href'));
    target.scrollIntoView({behavior:'smooth'});
  });
});

// --- Carrito ---
let cart = JSON.parse(localStorage.getItem('cart') || '[]');
function saveCart(){ localStorage.setItem('cart', JSON.stringify(cart)); }
function money(n){ return '$' + Number(n || 0).toFixed(2); }

// --- Render carrito ---
function renderCart(){
  // Se mantiene como en tu checkout
}

// --- Modal cantidad ---
let selectedProduct = null;
let selectedQty = 1;

function add(p){
  selectedProduct = p;
  selectedQty = 1;
  document.getElementById('modalProductName').textContent = p.name;
  document.getElementById('qtyValue').textContent = selectedQty;
  document.getElementById('qtyModal').style.display = 'flex';
}

document.getElementById('incQty').addEventListener('click',()=>{
  selectedQty++;
  document.getElementById('qtyValue').textContent = selectedQty;
});
document.getElementById('decQty').addEventListener('click',()=>{
  if(selectedQty>1) selectedQty--;
  document.getElementById('qtyValue').textContent = selectedQty;
});
document.getElementById('closeModal').addEventListener('click',()=>{
  document.getElementById('qtyModal').style.display = 'none';
});

// Confirmar y agregar al carrito
document.getElementById('addToCartModal').addEventListener('click',()=>{
  if(!selectedProduct) return;
  cart.push({
    product_name: selectedProduct.name,
    qty: selectedQty,
    unit_price: selectedProduct.price,
    subtotal: selectedProduct.price * selectedQty
  });
  saveCart();
  renderCart();
  document.getElementById('qtyModal').style.display = 'none';
  selectedProduct = null;
  selectedQty = 1;
});

// --- Fetch de productos ---
(async ()=>{
  const r = await fetch('/api/products/');
  const data = await r.json();
  const html = (data||[]).filter(p=>p.available).map(p=>`
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card h-100 shadow-sm text-center">
        <img src="${p.image || 'default.jpg'}" class="card-img-top" alt="${p.name}">
        <div class="card-body">
          <h5 class="card-title">${p.name}</h5>
          <p class="card-text mb-2">$${p.price}</p>
          <button class="btn btn-outline-primary" onclick='add(${JSON.stringify(p)})'>Agregar</button>
        </div>
      </div>
    </div>
  `).join('');
  document.getElementById('products').innerHTML = html;
})();
</script>
{% endblock %}
